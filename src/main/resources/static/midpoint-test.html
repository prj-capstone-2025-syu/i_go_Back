<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-section h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .reset-btn {
            background-color: #e74c3c;
        }
        .reset-btn:hover {
            background-color: #c0392b;
        }
        .response-area {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            min-height: 100px;
            white-space: pre-wrap;
        }
        .success {
            border-left: 4px solid #27ae60;
            background-color: #d5f4e6;
        }
        .error {
            border-left: 4px solid #e74c3c;
            background-color: #fdf2f2;
        }
        .chat-history {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 5px;
        }
        .user-message {
            background-color: #e3f2fd;
            text-align: right;
        }
        .bot-message {
            background-color: #f1f8e9;
        }
        .example-buttons {
            margin: 10px 0;
        }
        .example-btn {
            background-color: #95a5a6;
            font-size: 12px;
            padding: 6px 12px;
        }
        .example-btn:hover {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸° í…ŒìŠ¤íŠ¸</h1>

        <!-- ê¸°ë³¸ ì¤‘ê°„ìœ„ì¹˜ ê³„ì‚° -->
        <div class="test-section">
            <h2>1. ê¸°ë³¸ ì¤‘ê°„ìœ„ì¹˜ ê³„ì‚°</h2>
            <div class="input-group">
                <label for="locations">ìœ„ì¹˜ ëª©ë¡ (ì‰¼í‘œë¡œ êµ¬ë¶„):</label>
                <input type="text" id="locations" placeholder="ì˜ˆ: ê°•ë‚¨ì—­, í™ëŒ€ì…êµ¬ì—­, ì‹ ë¦¼ì—­"
                       value="ê°•ë‚¨ì—­, í™ëŒ€ì…êµ¬ì—­, ì‹ ë¦¼ì—­">
            </div>
            <button onclick="findBasicMidpoint()">ê¸°ë³¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸°</button>
            <div id="basicResult" class="response-area"></div>
        </div>

        <!-- ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸° (MVP í”Œë¡œìš°) -->
        <div class="test-section">
            <h2>2. ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸° (AI ëŒ€í™”í˜•)</h2>
            <p>MVP í”Œë¡œìš°: ì¸ì›ìˆ˜ â†’ ìœ„ì¹˜ ìˆ˜ì§‘ â†’ GPT-4 ì¶”ì²œ</p>

            <div class="input-group">
                <label for="smartMessage">ë©”ì‹œì§€:</label>
                <textarea id="smartMessage" placeholder="ì˜ˆ: ì¤‘ê°„ ì¥ì†Œ ì°¾ì•„ì¤˜"></textarea>
            </div>

            <div class="example-buttons">
                <button class="example-btn" onclick="setExampleMessage('ì¤‘ê°„ ì¥ì†Œ ì°¾ì•„ì¤˜')">ì‹œì‘í•˜ê¸°</button>
                <button class="example-btn" onclick="setExampleMessage('3ëª…')">3ëª…</button>
                <button class="example-btn" onclick="setExampleMessage('ê°•ë‚¨ì—­, í™ëŒ€, ì‹ ë¦¼ì—­')">ìœ„ì¹˜ ì…ë ¥</button>
            </div>

            <button onclick="findSmartMidpoint()">ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸°</button>
            <button class="reset-btn" onclick="resetSession()">ì„¸ì…˜ ì´ˆê¸°í™”</button>

            <div class="input-group" style="margin-top: 15px;">
                <label>ëŒ€í™” íˆìŠ¤í† ë¦¬:</label>
                <div id="chatHistory" class="chat-history"></div>
            </div>
        </div>

        <!-- ì¶”ê°€ ì˜µì…˜ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>3. ê³ ê¸‰ ì˜µì…˜ í…ŒìŠ¤íŠ¸</h2>
            <div class="input-group">
                <label for="purpose">ë§Œë‚¨ ëª©ì :</label>
                <input type="text" id="purpose" placeholder="ì˜ˆ: íšŒì˜, ì‹ì‚¬, ë†€ê¸°">
            </div>
            <div class="input-group">
                <label for="preferences">ì¥ì†Œ ì„ í˜¸ë„:</label>
                <input type="text" id="preferences" placeholder="ì˜ˆ: ì¹´í˜, ì‹ë‹¹, ì§€í•˜ì² ì—­ ê·¼ì²˜">
            </div>
            <button onclick="findSmartMidpointWithOptions()">ì˜µì…˜ í¬í•¨ ìŠ¤ë§ˆíŠ¸ ì°¾ê¸°</button>
            <div id="advancedResult" class="response-area"></div>
        </div>

        <!-- ì§€ì—­ë³„ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>4. ì§€ì—­ë³„ Geocoding í…ŒìŠ¤íŠ¸</h2>
            <p>Google Geocoding APIì˜ í•œêµ­/í•´ì™¸ ìœ„ì¹˜ ì¸ì‹ í…ŒìŠ¤íŠ¸</p>

            <div class="input-group">
                <label>í•œêµ­ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸:</label>
                <div class="example-buttons">
                    <button class="example-btn" onclick="testSingleLocation('ì„œìš¸ì—­')">ì„œìš¸ì—­</button>
                    <button class="example-btn" onclick="testSingleLocation('ê°•ë‚¨ì—­')">ê°•ë‚¨ì—­</button>
                    <button class="example-btn" onclick="testSingleLocation('í™ëŒ€ì…êµ¬ì—­')">í™ëŒ€ì…êµ¬ì—­</button>
                    <button class="example-btn" onclick="testSingleLocation('ë¶€ì‚°ì—­')">ë¶€ì‚°ì—­</button>
                    <button class="example-btn" onclick="testSingleLocation('ì œì£¼ê³µí•­')">ì œì£¼ê³µí•­</button>
                </div>
            </div>

            <div class="input-group">
                <label>í•´ì™¸ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸:</label>
                <div class="example-buttons">
                    <button class="example-btn" onclick="testSingleLocation('Times Square, New York')">Times Square</button>
                    <button class="example-btn" onclick="testSingleLocation('Eiffel Tower, Paris')">Eiffel Tower</button>
                    <button class="example-btn" onclick="testSingleLocation('Tokyo Station')">Tokyo Station</button>
                    <button class="example-btn" onclick="testSingleLocation('Big Ben, London')">Big Ben</button>
                </div>
            </div>

            <div class="input-group">
                <label for="customLocation">ì§ì ‘ ì…ë ¥:</label>
                <input type="text" id="customLocation" placeholder="í…ŒìŠ¤íŠ¸í•  ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="testCustomLocation()">ë‹¨ì¼ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸</button>
            </div>

            <div id="locationTestResult" class="response-area"></div>
        </div>

        <!-- API ìƒíƒœ í™•ì¸ -->
        <div class="test-section">
            <h2>5. API ìƒíƒœ ë° í• ë‹¹ëŸ‰ í™•ì¸</h2>
            <button onclick="checkAPIStatus()">Google Maps API ìƒíƒœ í™•ì¸</button>
            <button onclick="testMultipleLocations()">ë‹¤ì¤‘ ìœ„ì¹˜ ë™ì‹œ í…ŒìŠ¤íŠ¸</button>
            <div id="apiStatusResult" class="response-area"></div>
        </div>
    </div>

    <script>
        let chatHistory = [];

        // ê¸°ë³¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸°
        async function findBasicMidpoint() {
            const locations = document.getElementById('locations').value.split(',').map(loc => loc.trim());
            const resultDiv = document.getElementById('basicResult');

            if (locations.length < 2) {
                showResult(resultDiv, 'ìµœì†Œ 2ê°œ ì´ìƒì˜ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', false);
                return;
            }

            try {
                const response = await fetch('/api/midpoint/find', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        locations: locations
                    })
                });

                const data = await response.json();
                showResult(resultDiv, JSON.stringify(data, null, 2), response.ok);
            } catch (error) {
                showResult(resultDiv, 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        // ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸°
        async function findSmartMidpoint() {
            const message = document.getElementById('smartMessage').value;

            if (!message.trim()) {
                alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch('/api/midpoint/smart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message
                    })
                });

                const data = await response.json();

                // ëŒ€í™” íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                addToChatHistory('user', message);
                addToChatHistory('bot', data.message || JSON.stringify(data, null, 2));

                // ë©”ì‹œì§€ ì…ë ¥ë€ ì´ˆê¸°í™”
                document.getElementById('smartMessage').value = '';

            } catch (error) {
                addToChatHistory('bot', 'ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ì˜µì…˜ í¬í•¨ ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸°
        async function findSmartMidpointWithOptions() {
            const message = document.getElementById('smartMessage').value;
            const purpose = document.getElementById('purpose').value;
            const preferences = document.getElementById('preferences').value;
            const resultDiv = document.getElementById('advancedResult');

            const requestBody = {
                message: message || 'ì¤‘ê°„ ì¥ì†Œ ì°¾ì•„ì¤˜'
            };

            if (purpose) requestBody.purpose = purpose;
            if (preferences) requestBody.preferences = preferences;

            try {
                const response = await fetch('/api/midpoint/smart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResult(resultDiv, JSON.stringify(data, null, 2), response.ok);
            } catch (error) {
                showResult(resultDiv, 'ì˜¤ë¥˜: ' + error.message, false);
            }
        }

        // ì„¸ì…˜ ì´ˆê¸°í™”
        async function resetSession() {
            try {
                const response = await fetch('/api/midpoint/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
                chatHistory = [];
                updateChatHistory();

                // ìƒˆë¡œìš´ ì„¸ì…˜ ì‹œì‘ ë©”ì‹œì§€ ì¶”ê°€
                addToChatHistory('bot', data.message || 'ì„¸ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');

            } catch (error) {
                addToChatHistory('bot', 'ì„¸ì…˜ ì´ˆê¸°í™” ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ì˜ˆì‹œ ë©”ì‹œì§€ ì„¤ì •
        function setExampleMessage(message) {
            document.getElementById('smartMessage').value = message;
        }

        // ëŒ€í™” íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        function addToChatHistory(sender, message) {
            chatHistory.push({ sender, message, timestamp: new Date() });
            updateChatHistory();
        }

        // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
        function updateChatHistory() {
            const chatDiv = document.getElementById('chatHistory');
            chatDiv.innerHTML = '';

            chatHistory.forEach(chat => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${chat.sender}-message`;

                const timestamp = chat.timestamp.toLocaleTimeString();
                const senderLabel = chat.sender === 'user' ? 'ğŸ‘¤ ì‚¬ìš©ì' : 'ğŸ¤– AI';

                messageDiv.innerHTML = `
                    <strong>${senderLabel}</strong> <small>(${timestamp})</small><br>
                    ${chat.message}
                `;

                chatDiv.appendChild(messageDiv);
            });

            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(element, result, isSuccess) {
            element.textContent = result;
            element.className = 'response-area ' + (isSuccess ? 'success' : 'error');
        }

        // ë‹¨ì¼ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸
        async function testSingleLocation(locationName) {
            const resultDiv = document.getElementById('locationTestResult');
            showResult(resultDiv, `í…ŒìŠ¤íŠ¸ ì¤‘: ${locationName}...`, true);

            try {
                const response = await fetch('/api/midpoint/find', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        locations: [locationName, locationName] // ë”ë¯¸ë¡œ 2ê°œ ìœ„ì¹˜ (ìµœì†Œ ìš”êµ¬ì‚¬í•­)
                    })
                });

                const data = await response.json();

                let resultText = `=== ${locationName} í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===\n`;
                resultText += `ì„±ê³µ: ${data.success}\n`;
                resultText += `ë©”ì‹œì§€: ${data.message}\n`;

                if (data.success && data.midpointCoordinates) {
                    resultText += `ì¢Œí‘œ: ${data.midpointCoordinates.lat}, ${data.midpointCoordinates.lng}\n`;
                    resultText += `ì£¼ì†Œ: ${data.midpointAddress}\n`;
                }

                showResult(resultDiv, resultText, data.success);
            } catch (error) {
                showResult(resultDiv, `ì˜¤ë¥˜: ${error.message}`, false);
            }
        }

        // ì»¤ìŠ¤í…€ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸
        function testCustomLocation() {
            const location = document.getElementById('customLocation').value;
            if (!location.trim()) {
                alert('ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            testSingleLocation(location);
        }

        // API ìƒíƒœ í™•ì¸
        async function checkAPIStatus() {
            const resultDiv = document.getElementById('apiStatusResult');
            showResult(resultDiv, 'API ìƒíƒœ í™•ì¸ ì¤‘...', true);

            const testLocations = [
                'Seoul Station',
                'ì„œìš¸ì—­',
                'New York',
                'Tokyo',
                'ë¶€ì‚°ì—­'
            ];

            let results = '=== Google Maps API ìƒíƒœ í™•ì¸ ===\n\n';

            for (let location of testLocations) {
                try {
                    const response = await fetch('/api/midpoint/find', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            locations: [location, location]
                        })
                    });

                    const data = await response.json();
                    results += `${location}: ${data.success ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
                    if (!data.success) {
                        results += `  ì˜¤ë¥˜: ${data.message}\n`;
                    }
                } catch (error) {
                    results += `${location}: âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n`;
                }

                // ì ì‹œ ëŒ€ê¸° (API ì œí•œ ë°©ì§€)
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            showResult(resultDiv, results, true);
        }

        // ë‹¤ì¤‘ ìœ„ì¹˜ ë™ì‹œ í…ŒìŠ¤íŠ¸
        async function testMultipleLocations() {
            const resultDiv = document.getElementById('apiStatusResult');
            showResult(resultDiv, 'ë‹¤ì¤‘ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸ ì¤‘...', true);

            const koreanLocations = ['ì„œìš¸ì—­', 'ë¶€ì‚°ì—­', 'ëŒ€êµ¬ì—­'];
            const internationalLocations = ['Tokyo Station', 'Beijing Station', 'New York Penn Station'];

            let results = '=== ë‹¤ì¤‘ ìœ„ì¹˜ ë™ì‹œ í…ŒìŠ¤íŠ¸ ===\n\n';

            // í•œêµ­ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸
            try {
                results += 'í•œêµ­ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸:\n';
                const koreanResponse = await fetch('/api/midpoint/find', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        locations: koreanLocations
                    })
                });

                const koreanData = await koreanResponse.json();
                results += `ê²°ê³¼: ${koreanData.success ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
                results += `ë©”ì‹œì§€: ${koreanData.message}\n\n`;
            } catch (error) {
                results += `í•œêµ­ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸: âŒ ì˜¤ë¥˜ - ${error.message}\n\n`;
            }

            // í•´ì™¸ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸
            try {
                results += 'í•´ì™¸ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸:\n';
                const intlResponse = await fetch('/api/midpoint/find', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        locations: internationalLocations
                    })
                });

                const intlData = await intlResponse.json();
                results += `ê²°ê³¼: ${intlData.success ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
                results += `ë©”ì‹œì§€: ${intlData.message}\n`;
            } catch (error) {
                results += `í•´ì™¸ ìœ„ì¹˜ í…ŒìŠ¤íŠ¸: âŒ ì˜¤ë¥˜ - ${error.message}\n`;
            }

            showResult(resultDiv, results, true);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            addToChatHistory('bot', 'ì•ˆë…•í•˜ì„¸ìš”! ìŠ¤ë§ˆíŠ¸ ì¤‘ê°„ìœ„ì¹˜ ì°¾ê¸° ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. "ì¤‘ê°„ ì¥ì†Œ ì°¾ì•„ì¤˜"ë¼ê³  ë§ì”€í•´ë³´ì„¸ìš”! ğŸ—ºï¸');
        });
    </script>
</body>
</html>
